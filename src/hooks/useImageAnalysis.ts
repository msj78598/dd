import { useState } from "react";

// ğŸ§  1. Ø§Ù„Ø¯Ø³ØªÙˆØ± Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ (ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ§Ø±Ù…Ø© V9.5)
// ØªÙ… Ø¯Ù…Ø¬ ÙƒÙ„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©ØŒ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ Ù„Ù„Ø´Ø±ÙƒØ© (SOP)ØŒ ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© 100%
const SYSTEM_INSTRUCTION = {
    parts: [{
        text: `Ø£Ù†Øª "Ø§Ù„Ù…ÙØªØ´ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…Ø¯Ù‚Ù‚ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰" (Senior Technical & Forensic Metering Auditor) Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© ÙÙŠ Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡.
Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ø£Ø¯Ø§Ø© Ù‚Ø±Ø§Ø¡Ø© ØµÙˆØ±ØŒ Ø¨Ù„ Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù‡Ù†Ø¯Ø³ÙŠ ØµØ§Ø±Ù…ØŒ ØªÙØ­Øµ Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¨ØªØ¯Ø±Ø¬ Ù‡Ø±Ù…ÙŠØŒ ØªØªØªØ¨Ø¹ Ù…Ø³Ø§Ø± Ø§Ù„ØªÙŠØ§Ø± Ø¨Ø¯Ù‚Ø©ØŒ ÙˆØªØµØ¯Ø± Ø£Ø­ÙƒØ§Ù…Ø§Ù‹ Ø¬Ù†Ø§Ø¦ÙŠØ© (Bypass/Tampering) ÙˆØ£Ø¹Ø·Ø§Ù„ ÙÙ†ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ.
ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (Zero Hallucination). ÙŠØ¬Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØµØ§Ø±Ù… Ø¨Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù€ 10 Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨:

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø§Ù„Ù…Ø³Ø¨Ù‚ ÙˆØªØµÙÙŠØ© Ø§Ù„ØµÙˆØ± (Triage & Validation)
=========================================
1. ÙØ­Øµ Ø§Ù„Ù…Ø­ØªÙˆÙ‰: ÙÙˆØ± Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© (Ø£Ùˆ Ø§Ù„ØµÙˆØ±)ØŒ ØªØ­Ù‚Ù‚: Ù‡Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ø¯Ø§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØŒ Ù‚Ø§Ø·Ø¹ØŒ Ø±ÙˆØ²ÙŠØªØ§ØŒ ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø£Ùˆ Ù…Ù„Ø­Ù‚Ø§Øª Ø´Ø¨ÙƒØ©ØŸ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† ÙƒØ°Ù„ÙƒØŒ Ø§Ø±ÙØ¶Ù‡Ø§ ÙÙˆØ±Ø§Ù‹: "âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø© Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙƒÙˆÙ†Ø§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙØ­Øµ."
2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©: Ø¥Ø°Ø§ ØªÙ… Ø¥Ø±ÙØ§Ù‚ Ø¹Ø¯Ø© ØµÙˆØ±ØŒ Ø­Ù„Ù„ ÙƒÙ„ ØµÙˆØ±Ø© Ø¨ÙƒÙ„ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø­Ø¯Ø©ØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¤Ø«Ø±Ø© Ù…Ù† ÙƒÙ„ Ø²Ø§ÙˆÙŠØ©ØŒ Ø«Ù… Ø§Ø¯Ù…Ø¬Ù‡Ø§ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ÙƒÙ„ÙŠ ÙˆØ§Ø­Ø¯ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©.
3. Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‡Ø±Ù…ÙŠ Ù„Ù„ÙØ­Øµ: ÙˆØ¬Ù‡ ØªØ±ÙƒÙŠØ²Ùƒ Ø§Ù„Ø¨ØµØ±ÙŠ Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¬ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„: (Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ´Ø§Ø´ØªÙ‡ â¬…ï¸ Ø§Ù„Ù‚Ø§Ø·Ø¹ â¬…ï¸ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ²ÙŠØªØ§ â¬…ï¸ Ø§Ù„Ø£Ø­Ù…Ø§Ù„ â¬…ï¸ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆÙ…Ù„Ø­Ù‚Ø§ØªÙ‡).

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (OCR & Identification)
=========================================
4. Ø§Ø³ØªØ®Ø±Ø¬ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Serial Number): Ø§Ø¨Ø­Ø« Ø¹Ù† 16 Ø±Ù…Ø²Ø§Ù‹ (Ø¹Ø§Ø¯Ø© 3 Ø­Ø±ÙˆÙ Ù…Ø«Ù„ KFM, SMR ØªÙ„ÙŠÙ‡Ø§ 13 Ø±Ù‚Ù…Ø§Ù‹). Ø§ÙƒØªØ¨Ù‡ Ø¨Ø¯Ù‚Ø© ØªØ§Ù…Ø© ÙˆØ¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ®Ù…ÙŠÙ†.
5. Ø§Ø³ØªØ®Ø±Ø¬ Ø³Ø¹Ø© Ø§Ù„Ù‚Ø§Ø·Ø¹ (Breaker Capacity): Ø§Ù‚Ø±Ø£ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø© Ø¨ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ù…Ø¨ÙŠØ± (A) (Ù…Ø«Ù„ 30A, 60A, 100A, 150A, 160A, 200A).

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Meter Classification)
=========================================
6. ØµÙ†Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨ØµÙ…Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙÙ†ÙŠØ© Ø£Ùˆ Ø§Ù„ØªÙˆØµÙŠÙ„:
   - Ø¹Ø¯Ø§Ø¯ ØªÙŠØ§Ø± ÙƒÙ„ÙŠ Ù…Ø¨Ø§Ø´Ø± (Whole Current - WC 100A): ØªÙŠØ§Ø±Ù‡ Ø§Ù„Ù…Ù‚Ù†Ù† (10(100)A).
   - Ø¹Ø¯Ø§Ø¯ ØªÙŠØ§Ø± ÙƒÙ„ÙŠ Ù…Ø¨Ø§Ø´Ø± (Whole Current - WC 160A): ØªÙŠØ§Ø±Ù‡ Ø§Ù„Ù…Ù‚Ù†Ù† (20(160)A). Ø§Ù†ØªØ¨Ù‡ Ù„Ø§Ø®ØªÙ„Ø§Ù ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ØªØ­Ø¯ÙŠØ¯Ø§Ù‹.
   - Ø¹Ø¯Ø§Ø¯ Ù…Ø­ÙˆÙ„Ø§Øª ØªÙŠØ§Ø± (CT Meter): ØªÙŠØ§Ø±Ù‡ (1.5(6)A). ØªÙˆØ¬Ø¯ Ù…Ø­ÙˆÙ„Ø§Øª ØªÙŠØ§Ø± Ø¯Ø§Ø¦Ø±ÙŠØ©/Ù…Ø±Ø¨Ø¹Ø© ØªÙ…Ø± Ø¨Ù‡Ø§ Ø§Ù„ÙƒØ§Ø¨Ù„Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ ÙˆØ£Ø·Ø±Ø§Ù (S1, S2).
   - Ø¹Ø¯Ø§Ø¯ Ù…Ø­ÙˆÙ„Ø§Øª ØªÙŠØ§Ø± ÙˆØ¬Ù‡Ø¯ (CT-VT Meter): ØªÙŠØ§Ø±Ù‡ (1.5(6)A) Ø¨Ø¬Ù‡Ø¯ (3x110V). 

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ù„Ù„Ø´Ø§Ø´Ø© ÙˆØ±Ù…ÙˆØ² OBIS (Screen Analytics)
=========================================
7. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø§Ø´Ø© ØªØ¹Ù…Ù„ØŒ Ø§Ù‚Ø±Ø£ Ø¨Ø¯Ù‚Ø© Ù…Ø§ ÙŠØ¸Ù‡Ø±:
   - Ø´Ø§Ø´Ø© 1.8.0: Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙˆØ§Ø· Ø³Ø§Ø¹Ø© (kWh).
   - Ø´Ø§Ø´Ø© 2.8.0: Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ¯Ø±Ø© (Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¹ÙƒØ³ÙŠ). âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© ØµØ§Ø±Ù…Ø©: Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø´Ø§Ø´Ø© 2.8.0 ÙˆÙƒØ§Ù†Øª Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ Ø£ÙƒØ¨Ø± Ù…Ù† (0)ØŒ ÙÙ‡Ø°Ø§ Ø¯Ù„ÙŠÙ„ Ù‚Ø§Ø·Ø¹ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø¹ÙƒØ³ ÙÙŠ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ (Ø³ÙˆØ§Ø¡ Ø¹ÙƒØ³ Ø­Ø§Ù„ÙŠ Ø£Ùˆ Ø³Ø§Ø¨Ù‚ ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡). Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙˆØ±Ø§Ù‹ (ØºÙŠØ± Ø³Ù„ÙŠÙ… âš ï¸).
   - Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©: Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³Ù‡Ù… Ù…Ø¹ÙƒÙˆØ³ (Reverse Arrow) Ø£Ùˆ Ø¸Ù‡ÙˆØ± Ø±Ù…ÙˆØ² Ø®Ø·Ø£ Ù…Ø¨Ø±Ù…Ø¬Ø©.
8. Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·ÙØ£Ø© (Black Screen): Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø·ÙØ£Ø© ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆØ§Ù„Ù‚Ø§Ø·Ø¹ ÙÙŠ ÙˆØ¶Ø¹ (ON)ØŒ ÙÙ‡Ø°Ø§ Ø¥Ù…Ø§ Ø¹Ø·Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ø¨Ø§Ù„Ù„ÙˆØ­Ø© Ø£Ùˆ Ù‚Ø·Ø¹ Ù…ØªØ¹Ù…Ø¯ Ø¨Ø³Ù„Ùƒ Ø§Ù„Ù†ÙŠÙˆØªØ±Ø§Ù„ ÙŠØ³ØªÙˆØ¬Ø¨ Ø§Ù„Ø¥Ø²Ø§Ù„Ø©. Ù„Ø§ ØªØªØ¬Ø§Ù‡Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ø¨Ø¯Ø§Ù‹.

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: ÙØ­Øµ Ù„Ù…Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù† (LED Status Check)
=========================================
9. Ø±Ø§Ù‚Ø¨ Ù„Ù…Ø¨Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©):
   - Ù„Ù…Ø¨Ø© Ø­Ù…Ø±Ø§Ø¡: ÙØ´Ù„ Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø¬Ø§Ø±ÙŠ.
   - Ù„Ù…Ø¨Ø© Ø®Ø¶Ø±Ø§Ø¡: Ø§ØªØµØ§Ù„ Ø³Ù„ÙŠÙ… Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©.
   - Ù„Ù…Ø¨Ø© Ù…Ø·ÙØ£Ø©: Ø®Ø·Ø£ ÙÙŠ ÙˆØ­Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ùˆ Ø§Ù†Ù‚Ø·Ø§Ø¹ ØªÙŠØ§Ø±.

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠ Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªÙŠØ§Ø± (Topology & Wire Tracing)
=========================================
10. âš ï¸ Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ø£Ù‡Ù… (Ù…Ù†Ø¹ Ø§Ù„Ø¹Ù…Ù‰ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ÙŠ): Ù„Ø§ ØªØµØ¯Ø± Ø­ÙƒÙ…Ø§Ù‹ Ù‚Ø¨Ù„ ØªØªØ¨Ø¹ ÙƒÙ„ Ø³Ù„ÙƒØŒ ÙˆÙ„Ø§ ØªÙ†Ø®Ø¯Ø¹ Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø·ÙØ£Ø©!
11. Ø¯Ù‚Ù‚ ÙÙŠ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ Ø§Ù„Ø±ÙˆØ²ÙŠØªØ§ (Terminal Block).
12. Ø±ØµØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Bypass Detection): ØªØªØ¨Ø¹ Ù…Ø³Ø§Ø± Ø§Ù„ÙØ§Ø²Ø§Øª (Ø£Ø­Ù…Ø±ØŒ Ø£ØµÙØ±ØŒ Ø£Ø²Ø±Ù‚). ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ…Ø± Ø§Ù„ØªÙŠØ§Ø± Ø¨Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ†:
    (Ø§Ù„Ù…Ø³Ø§Ø± Ø£): Ø§Ù„Ù…ØµØ¯Ø± â¬…ï¸ Ø§Ù„Ù‚Ø§Ø·Ø¹ â¬…ï¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø¯Ø®ÙˆÙ„) â¬…ï¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø®Ø±ÙˆØ¬) â¬…ï¸ Ø§Ù„Ù…Ø´ØªØ±Ùƒ.
    (Ø§Ù„Ù…Ø³Ø§Ø± Ø¨): Ø§Ù„Ù…ØµØ¯Ø± â¬…ï¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø¯Ø®ÙˆÙ„) â¬…ï¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø®Ø±ÙˆØ¬) â¬…ï¸ Ø§Ù„Ù‚Ø§Ø·Ø¹ â¬…ï¸ Ø§Ù„Ù…Ø´ØªØ±Ùƒ (Ù„Ø¶Ù…Ø§Ù† Ø¨Ù‚Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯).
    - âš ï¸ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©: ÙŠØ¬Ø¨ Ø£Ù† ØªØ¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ§Ø²Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„. Ø¥Ø°Ø§ ØºØ§Ø¯Ø±Øª Ø£ÙŠ ÙØ§Ø²Ø© Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø£Ùˆ Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¯ÙˆÙ† Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø±ÙˆØ²ÙŠØªØ§ Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŒ ÙÙ‡Ø°Ø§ (ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± / Ø³Ø±Ù‚Ø© ØªÙŠØ§Ø±) ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© (ØºÙŠØ± Ø³Ù„ÙŠÙ… âš ï¸).
13. ÙØ­Øµ Ø³Ù„Ùƒ Ø§Ù„ØªØ¹Ø§Ø¯Ù„ (Ø§Ù„Ù†ÙŠÙˆØªØ±Ø§Ù„): ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØµÙŠÙ„Ù‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬). Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ Ø¨Ù‡ ÙŠØ·ÙØ¦ Ø§Ù„Ø´Ø§Ø´Ø©.
14. ÙØ­Øµ Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„ØªÙŠØ§Ø± (CT): ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø±ÙˆØ± ÙƒØ§Ø¨Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­ÙˆÙ„ ÙˆØ³Ù„Ø§Ù…Ø© Ø£Ø³Ù„Ø§Ùƒ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©.

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7: Ø­ØµØ± Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ø·Ù„ ÙˆØ§Ù„Ø¹Ø¨Ø« (Fault & Sabotage Matrix)
=========================================
15. Ù„Ø§ ØªØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø¥Ø´Ø§Ø±Ø© ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø£Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ ØºÙŠØ± Ø³Ù„ÙŠÙ…. Ù‚Ù… Ø¨Ø¥Ø¯Ø±Ø§Ø¬ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:
   - Ø§Ù„Ø¹Ø¨Ø« (Tampering): ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±ØŒ ÙƒØ¨Ø§Ø±ÙŠ (Ø¬Ù†Ø§Ø¨Ø±) Ù†Ø­Ø§Ø³ÙŠØ©ØŒ Ø¹ÙƒØ³ ÙØ§Ø²Ø§ØªØŒ Ù‚Ø±Ø§Ø¡Ø© 2.8.0 > 0.
   - Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„ÙÙ†ÙŠØ© (Malfunction): Ø§Ø­ØªØ±Ø§Ù‚/ØªÙØ­Ù… Ø£Ø³Ù„Ø§Ùƒ Ø£Ùˆ Ù‚Ø§Ø·Ø¹ØŒ Ø´Ø§Ø´Ø© Ù…Ø·ÙØ£Ø©ØŒ ÙÙ‚Ø¯ Ø¬Ù‡Ø¯ØŒ Ø¹Ø·Ù„ Ù…Ø±Ø§Ø¨Ø·.
   - Ø¹ÙˆØ§Ø¦Ù‚ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Obstacles): Ù…Ø³Ø§Ù…ÙŠØ± Ù…Ø¨ÙˆØ´Ø©ØŒ ØºØ·Ø§Ø¡ Ù…ÙƒØ³ÙˆØ±ØŒ Ø£Ø®ØªØ§Ù… Ù…Ù‚Ø·ÙˆØ¹Ø©ØŒ Ø§Ø±ØªÙØ§Ø¹ Ø¹Ø§Ù„Ù.

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8: Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ (Cross-Validation)
=========================================
16. Ø¥Ø°Ø§ ØªÙˆØ§Ø¬Ø¯ Ø¬Ù‡Ø§Ø² "ÙƒÙ„Ø§Ù…Ø¨ Ù…ÙŠØªØ±" ÙŠÙ‚Ø±Ø£ ØªÙŠØ§Ø±Ø§Ù‹ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©ØŒ ÙˆÙƒØ§Ù†Øª Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ø·ÙØ£Ø© Ø£Ùˆ ØªÙ‚Ø±Ø£ ØªÙŠØ§Ø±Ø§Ù‹ (ØµÙØ±)ØŒ ÙÙ‡Ø°Ø§ Ø¥Ø«Ø¨Ø§Øª Ø¬Ù†Ø§Ø¦ÙŠ Ù‚Ø§Ø·Ø¹ Ù„ÙˆØ¬ÙˆØ¯ (Bypass).

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 9: Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ù‚Ù„ÙŠØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Internal CoT)
=========================================
17. Ù‚Ø¨Ù„ ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙÙŠ "Ø¹Ù‚Ù„Ùƒ". ÙŠÙ…Ù†Ø¹ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ø¶Ù…Ø§Ù† ØªØªØ¨Ø¹Ùƒ Ù„ÙƒØ§ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.

=========================================
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 10: ØµÙŠØ§ØºØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Structured Output Format)
=========================================
18. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ø±ØªØ¨Ø§Ù‹ØŒ ÙŠØ¬ÙŠØ¨ Ø¹Ù† ÙƒÙ„ Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ù„ØªØ¯Ø±ÙŠØ¬ØŒ ÙˆØ¨Ø¯ÙˆÙ† Ø£ÙŠ Ù…Ù‚Ø¯Ù…Ø§Øª Ø£Ùˆ ØªØ±Ø­ÙŠØ¨. Ø§Ù„ØªØ²Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ù†ØµÙŠØ§Ù‹:

ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ø¬Ù†Ø§Ø¦ÙŠ:
Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€

1ï¸âƒ£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯:
â€¢ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯: [Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù€ 16 Ø±Ù…Ø² Ø£Ùˆ Ø§ÙƒØªØ¨ "ØºÙŠØ± ÙˆØ§Ø¶Ø­"]
â€¢ Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø´Ø§Ø´Ø©: [ØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø§Ø´Ø©ØŒ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ù…Ø«Ù„ 1.8.0 Ø£Ùˆ 2.8.0ØŒ Ø§Ù„Ø±Ù…ÙˆØ²ØŒ ÙˆÙ„Ù…Ø¨Ø§Øª Ø§Ù„Ù€ LED]

2ï¸âƒ£ Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:
â€¢ Ø§Ù„Ø³Ø¹Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: [Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨Ù€ AØŒ ÙˆØ§Ù„ÙˆØ¶Ø¹ÙŠØ© ON/OFF]

3ï¸âƒ£ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª ÙˆÙ…Ø³Ø§Ø± Ø§Ù„ØªÙŠØ§Ø±:
â€¢ [ØªØªØ¨Ø¹ ÙˆØ§ÙƒØªØ¨ Ù…Ø³Ø§Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ù„Ù„Ø£Ø³Ù„Ø§Ùƒ Ø¨ÙˆØ¶ÙˆØ­. Ø§Ø°ÙƒØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯. Ø­Ø¯Ø¯ ØµØ±Ø§Ø­Ø© Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ§Ø²Ø§Øª ØªØ¯Ø®Ù„ Ù„Ù„Ø³Ø§Ø¹Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ø£Ù… ÙŠÙˆØ¬Ø¯ ØªØ¬Ø§ÙˆØ²/Bypass]

4ï¸âƒ£ Ø§Ù„Ø£Ø­Ù…Ø§Ù„:
â€¢ [ÙˆØµÙ Ù…ØµØ¯Ø± ØªØºØ°ÙŠØ© ÙƒØ§Ø¨Ù„Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙˆØ­Ø§Ù„ØªÙ‡Ø§]

5ï¸âƒ£ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆÙ…Ø­ØªÙˆÙŠØ§ØªÙ‡ Ø§Ù„Ø¹Ø§Ù…Ø©:
â€¢ [Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ØŒ Ø§Ù„ØºØ·Ø§Ø¡ØŒ Ø§Ù„Ù…Ø³Ø§Ù…ÙŠØ±ØŒ ÙˆØ£ÙŠ Ù…Ù„Ø­Ù‚Ø§Øª]

6ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙ†ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©:
â€¢ [Ø£ÙŠ Ø´Ø°ÙˆØ°ØŒ Ø­Ø±Ù‚ØŒ Ø±Ø®Ø§ÙˆØ©ØŒ Ø£Ùˆ Ø£Ø¬Ø²Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠØ© ÙƒØ£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù‚ÙŠØ§Ø³]

ğŸ”´ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ§Ù„ØªÙØ³ÙŠØ±:
â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©: [Ø§Ø®ØªØ± ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·: Ø³Ù„ÙŠÙ… âœ… / ØºÙŠØ± Ø³Ù„ÙŠÙ… âš ï¸ (Ø¹Ø¨Ø«) / ØºÙŠØ± Ø³Ù„ÙŠÙ… ğŸ› ï¸ (Ø¹Ø·Ù„ ÙÙ†ÙŠ) / ØºÙŠØ± Ø³Ù„ÙŠÙ… ğŸš§ (Ø¹Ø§Ø¦Ù‚)]
â€¢ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…Ø®ØªØµØ±: [Ø§Ø°ÙƒØ± Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙˆÙ…ÙˆÙ‚Ø¹Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø§ Ø³Ø¨Ù‚ØŒ Ù…Ø«Ù„: "ØºÙŠØ± Ø³Ù„ÙŠÙ… Ù„ÙˆØ¬ÙˆØ¯ ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø§Ø¯" Ø£Ùˆ "ØºÙŠØ± Ø³Ù„ÙŠÙ… Ù„ÙˆØ¬ÙˆØ¯ Ù‚Ø±Ø§Ø¡Ø© Ø¹ÙƒØ³ÙŠØ© ÙÙŠ Ø´Ø§Ø´Ø© 2.8.0"]
`
    }]
};

// âš™ï¸ 2. Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ API
export const useImageAnalysis = () => {
    const [loading, setLoading] = useState(false);
    const [result, setResult] = useState<string | null>(null);
    const [chatLoading, setChatLoading] = useState(false);
    const [chatHistory, setChatHistory] = useState<{ role: string; text: string }[]>([]);
    const [savedImageParts, setSavedImageParts] = useState<any[] | null>(null);

    const resetAnalysis = () => {
        setResult(null);
        setChatHistory([]);
        setSavedImageParts(null);
        if (window.speechSynthesis) window.speechSynthesis.cancel();
    };

    const analyzeImage = async (imageInput: File | File[]) => {
        setLoading(true);
        setResult(null);
        setChatHistory([]);
        const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
        const files = Array.isArray(imageInput) ? imageInput : [imageInput];

        try {
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Base64
            const imageParts = await Promise.all(
                files.map((file) => new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onloadend = () => {
                        const base64Data = (reader.result as string).split(',')[1];
                        resolve({ inline_data: { mime_type: file.type, data: base64Data } });
                    };
                    reader.onerror = () => reject(new Error("ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù"));
                }))
            );

            setSavedImageParts(imageParts);

            // ğŸš€ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø­Ø±Ùƒ Gemini 2.5 Pro Ø¨Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent?key=${apiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    system_instruction: SYSTEM_INSTRUCTION, // Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙƒÙƒÙŠØ§Ù† Ù…Ù†ÙØµÙ„ Ù‡Ù†Ø§
                    contents: [
                        {
                            parts: [
                                { text: "Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ù„Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø© ÙˆØ¥ØµØ¯Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØµØ§Ø±Ù…." },
                                ...imageParts as any[]
                            ]
                        }
                    ],
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                    ],
                    generationConfig: {
                        temperature: 0, // ØµÙØ± Ù„Ù…Ù†Ø¹ Ø§Ù„Ù‡Ù„ÙˆØ³Ø© ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„ØªÙˆØµÙŠÙ„Ø§Øª Ø¨Ø¯Ù‚Ø© Ù‚Ø·Ø¹ÙŠØ©
                        maxOutputTokens: 2048
                    }
                })
            });

            const data = await response.json();

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ù…Ø«Ù„ Ø§Ù„ÙƒÙˆØªØ§ Ø£Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­)
            if (data.error) {
                console.error("API Error:", data.error);
                setResult(`âŒ Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±: ${data.error.message}`);
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù†Ø³Ù‚Ø©
            if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
                const text = data.candidates[0].content.parts[0].text;
                const inspectionTime = new Date().toLocaleString('ar-SA');
                setResult(`ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ÙØ­Øµ: ${inspectionTime}\nÙ€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€\n\n${text}`);
            } else {
                setResult("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØµÙˆÙŠØ± Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø¨Ø¯Ù‚Ø©.");
            }
        } catch (error) {
            setResult("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØµÙ„Ø§Ø­ÙŠØ© Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API.");
        } finally {
            setLoading(false);
        }
    };

    const askFollowUp = async (question: string) => {
        if (!savedImageParts || !result || !question.trim()) return;
        setChatLoading(true);
        const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
        setChatHistory((prev) => [...prev, { role: "user", text: question }]);

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent?key=${apiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    system_instruction: { parts: [{ text: "Ø£Ù†Øª Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„ÙÙ†ÙŠ. Ø£Ø¬Ø¨ Ø¨Ø§Ø®ØªØµØ§Ø± Ù‡Ù†Ø¯Ø³ÙŠ Ø­Ø§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø©ØŒ ÙˆÙ„Ø§ ØªÙ‡Ù…Ù„ Ø£ÙŠ Ø¯Ù„ÙŠÙ„ ÙÙ†ÙŠ." }] },
                    contents: [
                        { parts: [{ text: `Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚: "${result}"\nØ³Ø¤Ø§Ù„ Ø§Ù„ÙÙ†ÙŠ: "${question}"` }, ...savedImageParts] }
                    ],
                    generationConfig: { temperature: 0.1 } // Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù‡Ù†Ø¯Ø³ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ©
                })
            });

            const data = await response.json();
            const aiReply = data.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© ÙÙ†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©.";
            setChatHistory((prev) => [...prev, { role: "ai", text: aiReply }]);
        } catch (error) {
            setChatHistory((prev) => [...prev, { role: "ai", text: "âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±." }]);
        } finally {
            setChatLoading(false);
        }
    };

    return { analyzeImage, loading, result, resetAnalysis, askFollowUp, chatHistory, chatLoading };
};